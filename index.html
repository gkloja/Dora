<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Dôra Atelier · Bordando histórias</title>
  
  <meta name="description" content="Dôra Atelier: onde cada peça é uma narrativa da Amazônia.">
  
  <!-- Fontes e ícones -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=Montserrat:wght@200;300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* Reset e variáveis */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --fio: #b38b6d;
      --fio-escuro: #8b5e3c;
      --tecido: #faf3ea;
      --sombra: #2e2a27;
      --ouro: #d4af37;
      --folha: #2c5530;
      
      --font-titulo: 'Cormorant Garamond', serif;
      --font-corpo: 'Montserrat', sans-serif;
      
      --transition-orgânica: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    body {
      background-color: var(--tecido);
      color: var(--sombra);
      font-family: var(--font-corpo);
      overflow-x: hidden;
      cursor: auto;
    }

    /* Loading tear */
    #tear-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--tecido);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: opacity 0.8s ease, visibility 0.8s;
    }

    #tear-loader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .tear-animation {
      width: 200px;
      height: 200px;
      position: relative;
    }

    .shuttle {
      position: absolute;
      width: 40px;
      height: 20px;
      background: var(--fio);
      border-radius: 10px;
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      animation: weave 2s infinite;
    }

    .thread-vertical {
      position: absolute;
      width: 2px;
      height: 100%;
      background: linear-gradient(to bottom, transparent, var(--fio), transparent);
      left: 50%;
      transform: translateX(-50%);
    }

    @keyframes weave {
      0% { left: 0; }
      50% { left: calc(100% - 40px); }
      100% { left: 0; }
    }

    /* Logo animada */
    .logo-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      width: 80px;
      height: 80px;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 1px solid var(--fio);
      transition: transform 0.3s var(--transition-orgânica);
    }

    .logo-container:hover {
      transform: scale(1.1) rotate(5deg);
    }

    .logo-container svg {
      width: 60px;
      height: 60px;
    }

    /* Hero */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 20px;
      background: radial-gradient(circle at 70% 30%, rgba(179,139,109,0.1) 0%, transparent 50%);
    }

    .hero h1 {
      font-family: var(--font-titulo);
      font-size: clamp(3rem, 15vw, 8rem);
      font-weight: 300;
      letter-spacing: 0.1em;
      line-height: 0.9;
      text-align: center;
      margin-bottom: 1rem;
      position: relative;
    }

    .hero h1 span {
      display: block;
      font-size: 0.3em;
      letter-spacing: 0.5em;
      margin-top: 1rem;
      color: var(--fio);
    }

    .hero p {
      font-size: 1.2rem;
      font-weight: 300;
      max-width: 600px;
      text-align: center;
      margin-bottom: 3rem;
      opacity: 0.8;
    }

    .scroll-prompt {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      color: var(--fio);
      animation: pulse 2s infinite;
    }

    /* Filtros flutuantes (não fixos) */
    .filter-float {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 40px auto 20px;
      padding: 10px;
      max-width: 500px;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(12px);
      border-radius: 60px;
      border: 1px solid rgba(179,139,109,0.3);
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      position: relative;
      z-index: 50;
    }

    .filter-btn {
      background: transparent;
      border: none;
      padding: 12px 30px;
      border-radius: 40px;
      font-family: var(--font-corpo);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--sombra);
      position: relative;
      overflow: hidden;
    }

    .filter-btn::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 2px;
      background: var(--fio);
      transition: width 0.3s;
    }

    .filter-btn.active::after,
    .filter-btn:hover::after {
      width: 80%;
    }

    .filter-btn.active {
      color: var(--fio-escuro);
      font-weight: 500;
    }

    /* Galeria 3D */
    .gallery {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 20px 80px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 30px;
      perspective: 2000px;
    }

    .card {
      position: relative;
      cursor: pointer;
      transform-style: preserve-3d;
      transform: rotateY(0deg) translateZ(0);
      transition: transform 0.6s var(--transition-orgânica), opacity 0.6s, box-shadow 0.4s;
      opacity: 0;
      border-radius: 4px;
      box-shadow: 0 20px 40px -20px rgba(0,0,0,0.2);
    }

    .card.visible {
      opacity: 1;
    }

    .card:hover {
      transform: rotateY(2deg) rotateX(1deg) translateZ(20px);
      box-shadow: 0 30px 60px -20px rgba(0,0,0,0.3);
    }

    .card-inner {
      position: relative;
      width: 100%;
      aspect-ratio: 3/4;
      overflow: hidden;
      border-radius: 4px;
      background: #e5dbd2;
    }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 1.2s var(--transition-orgânica);
      display: block;
    }

    .card:hover img {
      transform: scale(1.1);
    }

    .card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to top, rgba(0,0,0,0.5), transparent 50%);
      opacity: 0;
      transition: opacity 0.4s;
      display: flex;
      align-items: flex-end;
      padding: 20px;
    }

    .card:hover .card-overlay {
      opacity: 1;
    }

    .card-ref {
      color: white;
      font-size: 0.8rem;
      letter-spacing: 2px;
      transform: translateY(20px);
      transition: transform 0.4s;
    }

    .card:hover .card-ref {
      transform: translateY(0);
    }

    .multi-indicator {
      position: absolute;
      top: 15px;
      right: 15px;
      background: white;
      padding: 8px 12px;
      border-radius: 30px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      z-index: 2;
    }

    /* Modal interativo */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(250, 243, 234, 0.98);
      z-index: 5000;
      display: none;
      opacity: 0;
      transition: opacity 0.4s ease;
      overflow-y: auto;
    }

    .modal.active {
      display: block;
      opacity: 1;
    }

    .modal-content {
      min-height: 100%;
      display: flex;
      flex-direction: column;
      padding: 20px;
      position: relative;
    }

    /* Área de imagem com gesto de puxar */
    .modal-image-area {
      position: relative;
      width: 100%;
      height: 60vh;
      min-height: 400px;
      background: #222;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
      touch-action: pan-y pinch-zoom;
    }

    .modal-slider {
      display: flex;
      height: 100%;
      transition: transform 0.4s var(--transition-orgânica);
    }

    .modal-slide {
      min-width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-slide img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .modal-nav {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .nav-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.3s;
    }

    .nav-dot.active {
      background: var(--fio);
      transform: scale(1.5);
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: white;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .modal-close:hover {
      transform: rotate(90deg);
      background: var(--fio);
      color: white;
    }

    /* Instrução de swipe */
    .swipe-hint {
      text-align: center;
      margin: 10px 0;
      color: var(--fio);
      font-size: 0.8rem;
      opacity: 0.7;
    }

    /* Informações do modal */
    .modal-info {
      padding: 20px 0;
    }

    .modal-ref {
      font-size: 0.8rem;
      color: var(--fio);
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .modal-desc {
      line-height: 1.8;
      margin-bottom: 30px;
      color: var(--sombra);
    }

    .btn-wa {
      background: #25D366;
      color: white;
      text-decoration: none;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 12px;
      font-weight: 500;
      transition: all 0.3s;
      border: 1px solid transparent;
    }

    .btn-wa:hover {
      background: white;
      color: #25D366;
      border-color: #25D366;
      box-shadow: 0 10px 30px rgba(37,211,102,0.2);
    }

    /* Controles de som */
    .sound-controls {
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 2000;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .sound-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: white;
      border: 1px solid var(--fio);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: all 0.3s;
      color: var(--fio);
    }

    .sound-btn:hover {
      transform: scale(1.1);
      background: var(--fio);
      color: white;
    }

    .visualizer {
      display: flex;
      gap: 3px;
      height: 30px;
      align-items: flex-end;
    }

    .visualizer span {
      width: 4px;
      background: var(--fio);
      border-radius: 2px;
      animation: equalize 1.2s infinite;
    }

    .visualizer span:nth-child(1) { height: 10px; animation-delay: 0s; }
    .visualizer span:nth-child(2) { height: 20px; animation-delay: 0.2s; }
    .visualizer span:nth-child(3) { height: 15px; animation-delay: 0.4s; }
    .visualizer span:nth-child(4) { height: 25px; animation-delay: 0.1s; }
    .visualizer span:nth-child(5) { height: 12px; animation-delay: 0.3s; }

    @keyframes equalize {
      0%, 100% { transform: scaleY(0.5); }
      50% { transform: scaleY(1.5); }
    }

    /* WhatsApp fixo */
    .wa-fixed {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: #25D366;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      text-decoration: none;
      box-shadow: 0 10px 30px rgba(37,211,102,0.3);
      transition: all 0.3s;
      z-index: 2000;
    }

    .wa-fixed:hover {
      transform: scale(1.1) rotate(5deg);
    }

    footer {
      text-align: center;
      padding: 40px;
      border-top: 1px solid rgba(179,139,109,0.2);
      color: var(--fio);
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); }
      50% { opacity: 1; transform: translateX(-50%) scale(1.1); }
    }

    /* Responsivo */
    @media (max-width: 600px) {
      .filter-float {
        flex-wrap: wrap;
        border-radius: 30px;
        padding: 5px;
      }
      
      .filter-btn {
        padding: 8px 20px;
        font-size: 0.8rem;
      }
      
      .sound-controls {
        bottom: 20px;
        left: 20px;
      }
      
      .wa-fixed {
        bottom: 20px;
        right: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- Loader -->
  <div id="tear-loader">
    <div class="tear-animation">
      <div class="shuttle"></div>
      <div class="thread-vertical"></div>
      <div class="thread-vertical" style="left: 30%;"></div>
      <div class="thread-vertical" style="left: 70%;"></div>
    </div>
    <p style="margin-top: 2rem; font-family: var(--font-titulo); font-size: 1.5rem;">Bordando histórias...</p>
  </div>

  <!-- Logo -->
  <div class="logo-container" id="logo">
    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="50" cy="50" r="45" stroke="#b38b6d" stroke-width="2" fill="none"/>
      <path d="M30 50 L70 50 M50 30 L50 70" stroke="#b38b6d" stroke-width="3" stroke-linecap="round"/>
      <circle cx="50" cy="50" r="10" fill="#b38b6d" opacity="0.3"/>
    </svg>
  </div>

  <!-- Hero -->
  <section class="hero">
    <h1>
      DÔRA
      <span>ATELIER</span>
    </h1>
    <p>Artesanato que carrega a alma da Amazônia. Cada peça, uma história única tecida à mão.</p>
    <div class="scroll-prompt">
      <i class="fas fa-chevron-down"></i>
      <span>descubra</span>
    </div>
  </section>

  <!-- Filtros flutuantes -->
  <div class="filter-float">
    <button class="filter-btn active" id="filterLatest">Lançamentos</button>
    <button class="filter-btn" id="filterRandom">Surpreenda</button>
  </div>

  <!-- Galeria -->
  <div class="gallery" id="gallery"></div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalCloseBtn">&times;</button>
      
      <div class="modal-image-area" id="modalImageArea">
        <div class="modal-slider" id="modalSlider"></div>
        <div class="modal-nav" id="modalDots"></div>
      </div>
      
      <div class="swipe-hint">
        <i class="fas fa-arrows-alt-h"></i> Arraste para ver mais fotos
      </div>
      
      <div class="modal-info">
        <div class="modal-ref" id="modalRef"></div>
        <p class="modal-desc" id="modalDesc"></p>
        <a href="#" class="btn-wa" id="modalWa" target="_blank">
          <span>Reservar via WhatsApp</span>
          <i class="fab fa-whatsapp"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Controles de som -->
  <div class="sound-controls">
    <div class="sound-btn" id="radioBtn">
      <i class="fas fa-play" id="radioIcon"></i>
    </div>
    <div class="visualizer" id="visualizer">
      <span></span><span></span><span></span><span></span><span></span>
    </div>
  </div>

  <!-- WhatsApp fixo -->
  <a href="https://wa.me/559292055895" class="wa-fixed" target="_blank">
    <i class="fab fa-whatsapp"></i>
  </a>

  <footer>
    <p>© 2026 Dôra Atelier · Manaus, Amazonas</p>
    <p style="margin-top: 10px; font-size: 0.7rem;">Cada ponto carrega um pedaço da floresta</p>
  </footer>

  <script>
    // -------------------- SONS --------------------
    // Criar sons suaves para interações (usando Web Audio API para ser leve)
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = null;

    function playClickSound() {
      if (!audioCtx) {
        audioCtx = new AudioContext();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.value = 600;
      gain.gain.value = 0.1;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.05);
    }

    function playHoverSound() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.value = 400;
      gain.gain.value = 0.05;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.02);
    }

    // Ativar sons após primeira interação do usuário
    document.body.addEventListener('click', function initAudio() {
      if (!audioCtx) {
        audioCtx = new AudioContext();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }, { once: true });

    // -------------------- RÁDIO --------------------
    const radioBtn = document.getElementById('radioBtn');
    const radioIcon = document.getElementById('radioIcon');
    const visualizer = document.getElementById('visualizer');
    let radioPlaying = false;
    let audioElement = null;

    radioBtn.addEventListener('click', () => {
      if (!radioPlaying) {
        // Usar uma rádio online confiável (ex: FluxFM - alternativa)
        if (!audioElement) {
          audioElement = new Audio('https://stream.radiojar.com/4ywdgup3bnzuv');
          audioElement.loop = false;
          audioElement.volume = 0.3;
        }
        audioElement.play().then(() => {
          radioPlaying = true;
          radioIcon.className = 'fas fa-pause';
          visualizer.style.opacity = '1';
        }).catch(e => {
          console.log('Erro rádio:', e);
          // Fallback: simular visualização mesmo sem som
          radioPlaying = true;
          radioIcon.className = 'fas fa-pause';
          visualizer.style.opacity = '1';
        });
      } else {
        if (audioElement) {
          audioElement.pause();
        }
        radioPlaying = false;
        radioIcon.className = 'fas fa-play';
        visualizer.style.opacity = '0.3';
      }
    });

    // -------------------- DADOS --------------------
    const TOTAL_IMAGENS = 114;
    const rawGroups = [
      [1, 2, 3, 53], [24, 25, 26], [56, 57, 58], [76, 83],
      [87, 88, 89], [86, 90, 91], [105, 106, 111], [108, 109, 101, 114],
      [10, 31, 64], [103, 107], [22, 37, 72], [34, 49, 59, 67], [100, 95]
    ];

    const descricoes = [
      "Inspirada nas tramas amazônicas, esta peça carrega a textura da floresta em cada detalhe.",
      "A linha encontra a tradição neste design contemporâneo. Uma homenagem às artesãs do Rio Negro.",
      "Feita com algodão natural tingido com jenipapo. A terra se revela em cada fio.",
      "Técnica ancestral de bordado que leva dias para ser concluída. Exclusividade e arte.",
      "O ouro do buriti encontra a delicadeza do crochê. Uma peça para durar gerações.",
      "Desenho autoral que remete às ondas do encontro das águas. Leveza e movimento."
    ];

    let catalogo = [];
    const processedIds = new Set();

    rawGroups.forEach(group => {
      const mainId = group[0];
      const images = group.map(id => `imagens/${id.toString().padStart(3, '0')}.jpg`);
      catalogo.push({
        id: mainId,
        displayId: mainId.toString().padStart(3, '0'),
        images: images,
        isGroup: true,
        desc: descricoes[Math.floor(Math.random() * descricoes.length)]
      });
      group.forEach(id => processedIds.add(id));
    });

    for (let i = 1; i <= TOTAL_IMAGENS; i++) {
      if (!processedIds.has(i)) {
        catalogo.push({
          id: i,
          displayId: i.toString().padStart(3, '0'),
          images: [`imagens/${i.toString().padStart(3, '0')}.jpg`],
          isGroup: false,
          desc: descricoes[Math.floor(Math.random() * descricoes.length)]
        });
      }
    }

    catalogo.sort((a, b) => a.id - b.id);

    // -------------------- RENDER GALERIA --------------------
    const gallery = document.getElementById('gallery');
    let currentCatalog = [...catalogo];

    function renderGallery(items) {
      gallery.innerHTML = '';
      items.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.style.transitionDelay = `${index * 20}ms`;

        card.innerHTML = `
          <div class="card-inner">
            <img src="${item.images[0]}" alt="Peça Dôra" loading="lazy">
            <div class="card-overlay">
              <span class="card-ref">REF ${item.displayId}</span>
            </div>
            ${item.images.length > 1 ? `
              <div class="multi-indicator">
                <i class="fas fa-images"></i> ${item.images.length}
              </div>
            ` : ''}
          </div>
        `;

        card.addEventListener('click', () => {
          playClickSound();
          openModal(item);
        });

        card.addEventListener('mouseenter', playHoverSound);

        observer.observe(card);
        gallery.appendChild(card);
      });
    }

    // Intersection Observer
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    // -------------------- MODAL --------------------
    const modal = document.getElementById('modal');
    const modalSlider = document.getElementById('modalSlider');
    const modalDots = document.getElementById('modalDots');
    const modalRef = document.getElementById('modalRef');
    const modalDesc = document.getElementById('modalDesc');
    const modalWa = document.getElementById('modalWa');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    let currentItem = null;
    let currentSlide = 0;
    let startX = 0;

    function openModal(item) {
      currentItem = item;
      currentSlide = 0;
      
      modalRef.textContent = `REF: ${item.displayId}`;
      modalDesc.textContent = item.desc;
      
      // Atualizar link WhatsApp com a primeira imagem
      updateWaLink(0);
      
      // Construir slides
      modalSlider.innerHTML = '';
      modalDots.innerHTML = '';
      
      item.images.forEach((src, idx) => {
        const slide = document.createElement('div');
        slide.className = 'modal-slide';
        slide.innerHTML = `<img src="${src}" alt="Detalhe">`;
        modalSlider.appendChild(slide);
        
        if (item.images.length > 1) {
          const dot = document.createElement('div');
          dot.className = `nav-dot ${idx === 0 ? 'active' : ''}`;
          dot.addEventListener('click', () => goToSlide(idx));
          modalDots.appendChild(dot);
        }
      });
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function updateWaLink(slideIndex) {
      if (!currentItem) return;
      const imageUrl = `https://atelierdora.onrender.com/${currentItem.images[slideIndex]}`;
      const msg = `Olá Dôra! Me interessei por esta peça (${imageUrl}) da sua coleção. Gostaria de mais informações.`;
      modalWa.href = `https://wa.me/559292055895?text=${encodeURIComponent(msg)}`;
    }

    function goToSlide(index) {
      if (!currentItem) return;
      if (index < 0) index = currentItem.images.length - 1;
      if (index >= currentItem.images.length) index = 0;
      
      currentSlide = index;
      modalSlider.style.transform = `translateX(-${index * 100}%)`;
      
      const dots = document.querySelectorAll('.nav-dot');
      dots.forEach((dot, i) => {
        if (i === index) dot.classList.add('active');
        else dot.classList.remove('active');
      });
      
      updateWaLink(index);
    }

    // Eventos de toque para navegação
    modalSlider.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    modalSlider.addEventListener('touchend', (e) => {
      if (!startX) return;
      const endX = e.changedTouches[0].clientX;
      const diff = endX - startX;
      
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          goToSlide(currentSlide - 1);
        } else {
          goToSlide(currentSlide + 1);
        }
      }
      startX = 0;
    });

    // Fechar modal com gesto de puxar para baixo
    let startY = 0;
    modalSlider.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
    });

    modalSlider.addEventListener('touchmove', (e) => {
      if (!startY) return;
      const currentY = e.touches[0].clientY;
      const diff = currentY - startY;
      if (diff > 50) {
        closeModal();
      }
    });

    // Fechar com botão
    modalCloseBtn.addEventListener('click', closeModal);

    // Fechar com tecla ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    // -------------------- FILTROS --------------------
    document.getElementById('filterLatest').addEventListener('click', function() {
      playClickSound();
      document.getElementById('filterRandom').classList.remove('active');
      this.classList.add('active');
      renderGallery(catalogo);
    });

    document.getElementById('filterRandom').addEventListener('click', function() {
      playClickSound();
      document.getElementById('filterLatest').classList.remove('active');
      this.classList.add('active');
      const shuffled = [...catalogo].sort(() => 0.5 - Math.random());
      renderGallery(shuffled);
    });

    // -------------------- LOADING --------------------
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('tear-loader').classList.add('hidden');
        renderGallery(catalogo);
      }, 2000);
    });

    // Inicializar visualizador (mesmo sem som)
    visualizer.style.opacity = '0.3';
  </script>
</body>
</html>
